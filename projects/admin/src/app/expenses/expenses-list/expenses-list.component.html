<div class="animated fadeIn">
  <div class="card">
    <div class="card-header">
      Expenses
      <div class="card-actions">
        <a [routerLink]="['new']">
          <i class="icon-plus icons font-xl"></i>
        </a>
      </div>
    </div>
    <div class="card-block">
      <div class="row mb-3">
        <div class="col-md-auto" [formGroup]="dateRangeForm">
          <div class="form-group">
            <label>From</label>
            <bx-dp-mobile
              [form]="dateRangeForm"
              controlName="from"
              [bsConfig]="bsConfig"
              (bsValueChange)="selectedFromDate($event)"
            ></bx-dp-mobile>
          </div>
          <div class="form-group">
            <label>To</label>
            <bx-dp-mobile
              [form]="dateRangeForm"
              controlName="to"
              [bsConfig]="bsConfig"
              (bsValueChange)="selectedToDate($event)"
            ></bx-dp-mobile>
          </div>
        </div>
        <div class="form-group col-md-auto ml-auto">
          <bx-category-select
            [category]="parentCategory"
            [selectedTerm]="category"
            [grouped]="false"
            (onFilter)="filterCategory($event)"
          ></bx-category-select>
        </div>
        <div class="col-md-auto">
          <select
            [(ngModel)]="source"
            class="form-control"
            (change)="filterSource(source)"
          >
            <option [ngValue]="undefined" selected>All sources</option>
            <option value="{{ source }}" *ngFor="let source of getSources()">{{
              source
            }}</option>
          </select>
        </div>
        <div class="col-md-auto">
          <div class="input-group">
            <span class="input-group-prepend">
              <span class="input-group-text">
                <i class="fa fa-search"></i>
              </span>
            </span>
            <input
              #searchField
              [(ngModel)]="search"
              (keyup)="searchAmount(searchField.value)"
              type="text"
              class="form-control"
              placeholder="Amount"
            />
          </div>
        </div>
      </div>
      <div class="table-responsive">
        <table class="table table-striped mt-5">
          <thead>
            <tr>
              <th>Expense</th>
              <th *ngIf="data.company === 'My New Flat'">Property</th>
              <th>Details</th>
              <th>Receipt</th>
              <th>% Claimed</th>
              <th>Payer</th>
              <th>Source</th>
              <th>Date</th>
              <th>Currency</th>
              <th>Amount</th>
              <th>Amount GBP</th>
              <th>Sub Total</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <ng-container *ngFor="let expense of items">
              <tr class="table-primary">
                <td [attr.colspan]="data.company === 'My New Flat' ? 13 : 12">
                  <strong>{{ expense._id }}</strong>
                </td>
              </tr>
              <tr
                [item]="item"
                *ngFor="let item of expense.expenses"
                bx-expenses-item
                (onDeleted)="deleteConfirm($event)"
              ></tr>
              <tr class="table-danger">
                <td
                  [attr.colspan]="data.company === 'My New Flat' ? 11 : 10"
                ></td>
                <td colspan="2">
                  <strong>{{
                    expense.total | currency: 'GBP':'symbol'
                  }}</strong>
                </td>
              </tr>
            </ng-container>
          </tbody>
          <tfoot>
            <tr class="table-primary">
              <td
                [attr.colspan]="data.company === 'My New Flat' ? 12 : 11"
                class="text-right"
              >
                <strong>{{
                  calculateTotal('total', 0) | currency: 'GBP':'symbol'
                }}</strong>
              </td>
              <td></td>
            </tr>
          </tfoot>
        </table>
      </div>
    </div>
  </div>
</div>
